{% extends "base.html" %}

{%block content %}
{% load static %}

  <div class="container-11 w-container boxshadow">
    <div class="tableheaders">Items in Cart</div>
  </div>
  <div class="container-12 w-container ">
    <div class="topdiv next">
      <div class="columns-8 w-row">
        <div class="column-15 w-col w-col-2">
          <div class="tableheaders custom">Image</div>
        </div>
        <div class="column-16 w-col w-col-2">
          <div class="tableheaders custom">Quantity</div>
        </div>
        <div class="column-17 w-col w-col-3">
          <div class="tableheaders custom">price (Unit)</div>
        </div>
        <div class="column-18 w-col w-col-3">
          <div class="tableheaders custom">Total</div>
        </div>
        <div class="w-col w-col-2">
          <div class="tableheaders custom a">Remove</div>
        </div>
      </div>
    </div>
    <div class="cartitemswrapper">
      <ul class="w-list-unstyled">
        <li>


          <div class="carttem boxshadow">
            
            {%if cart %}
             {% for item in cart %}
            
            
            <div class="columns-7 w-row boxshadow">
              <div class="column-10 w-col w-col-2"><img src="/static/products/{{ item.product.image }}" width="59" alt="" class="image-12"></div>
              <div class="column-11 w-col w-col-2">
                <div class="w-form">
                  <form id="email-form-2" name="email-form-2" data-name="Email Form 2">
                    <input type="number" class="text-field-3 w-input" maxlength="256" name="cartquantity{{item.product.id}}" data-name="Sd 2" value="{{ item.quantity }}" oninput="what_to_call({{item.product.id}})"  id="{{item.product.id}}">
                  </form>

                  <div class="w-form-done">
                    <div>Thank you! Your submission has been received!</div>
                  </div>
                  <div class="w-form-fail">
                    <div>Oops! Something went wrong while submitting the form.</div>
                  </div>
                </div>
              </div>
              <div class="column-13 w-col w-col-3">
                <div class="text-block-11">{{ item.product.price }}</div>
              </div>
              <div class="column-14 w-col w-col-3">
                <div class="text-block-11">{{ item.total_price }}</div>
              </div>
              <div class="column-12 w-col w-col-2"><img src="/static/images/Rectangle-1.png" width="29" srcset="/static/images/Rectangle-1-p-500.png 500w, /static/images/Rectangle-1.png 522w" sizes="(max-width: 479px) 22vw, 29px" alt="" class="image-13"></div>
            </div>
            {% endfor %}
            {% else %}
                <div class="tableheaders">Your Cart is empty</div> 
            
            
            {% endif %}



          </div>
        </li>
      </ul>
    </div>
  </div>
 
  <div class="container-11 w-container boxshadow">
    <div class="tableheaders"> Total {{summmary}}</div>
  </div>

  <div class="container-13 w-container boxshadow">
    <div class="w-row ">
      <div class="moneyotdelaycolumn w-col w-col-6"><a href="#" class="button-5 w-button">Continue Shopping</a></div>
      <div class="column-20 moneyotdelaycolumn w-col w-col-6"><a href="#" class="button-4 w-button">Proceed to checkout</a></div>
    </div>
  </div>
  <div data-w-id="afc79440-6fb5-ede0-19b0-c029c982bd85" class="cartpopup">
    <div>
      <div class="div-block-2"><img src="static/images/baseline_close_black_18dp.png" data-w-id="afc79440-6fb5-ede0-19b0-c029c982bd88" alt="" class="image-14">
        <div class="text-block-13 tableheaders"><strong>Shopping Cart</strong></div>
      </div>
      <h1 class="heading-6 tableheaders">Proceed to checkout as soon as you&#x27;re ready.<br></h1>
    </div>
    <ul class="w-list-unstyled">
      <li>
        <div class="itemcartpopup">
          <div class="itempopupcart w-row">
            <div class="column-22 w-col w-col-4"><img src="images/71lXNFifsgL._SY550_.jpg" width="46" alt="" class="image-15"></div>
            <div class="w-col w-col-4">
              <div class="form-block w-form">
                <form id="email-form-3" name="email-form-3" data-name="Email Form 3" class="form-2">

                  <input type="number" class="text-field-4 w-input" maxlength="256" name="field-2" data-name="Field 2" placeholder="1" id="field-2" required="" oninput="what_to_call("{{item.product.id}}")" >

                </form>
                <div class="w-form-done">
                  <div>Thank you! Your submission has been received!</div>
                </div>
                <div class="w-form-fail">
                  <div>Oops! Something went wrong while submitting the form.</div>
                </div>
              </div><a href="#" class="button-6 w-button">Remove </a></div>
            <div class="w-col w-col-4">
              <div class="text-block-16">KSH 3500</div>
            </div>
          </div>
        </div>
      </li>
    </ul>
    <div class="div-block-3 div-block-4 div-block-5 div-block-6 div-block-7 div-block-8 div-block-9 div-block-10 div-block-11 div-block-12">
      <div class="w-row">
        <div class="w-col w-col-6"><a href="#" class="button-7 button-8 button-9 button-10 button-11 button-12 button-13 button-14 button-15 button-16 button-17 button-18 button-19 button-20 w-button">Checkout</a></div>
        <div class="column-21 w-col w-col-6">
          <div class="text-block-17 text-block-18 text-block-19 text-block-20 text-block-21 tableheaders">KSH 13500</div>
        </div>
      </div>
    </div>
  </div>
  <script >
    document.getElementsByClassName('cartpopup')[0].style.display="none";

    function what_to_call(id){
      value=document.getElementById(String(id)).value;
      if (value==""){
        return false;
      }
      cart={};

      {% for item in cart %}
          cart['{{item.product.id}}']={{item.quantity}};
      {% endfor %}
      


      if (Number(cart[String(id)])<Number(value)){
          AjaxAdd(id) ;
      }
      else{
        AjaxMinus(id) ;
      }

    }
  

    function showcart(){
  
  document.getElementsByClassName('cartpopup')[0].style.display="block";
}
  
  function AjaxAdd(id) {
        $.ajax({
            url: "/add_to_cart_ajax/"+id,
            success: function(response) {location.reload();},
            error: function() {alert("Couldn't remove item");}  
        })
       } 

  function AjaxMinus(id) {
        
        $.ajax({
            url: "/minus_cart_ajax/"+id,
            success: function(response) {location.reload();},
            error: function() {alert("Couldn't remove item");}  
        })
       } 


  </script>
{%endblock%}